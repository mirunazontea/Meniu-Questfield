<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meniu Questfield</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <style>
        /* --- DESIGN QUESTFIELD ORIGINAL --- */
        :root {
            --q-blue: #0E2636;
            --q-gold: #CE9F49;
            --q-green: #E2EFDA;
            --q-white: #FFFFFF;
            --q-bg: #F9F9F9;
            --q-text: #333333;
            --border: #E0E0E0;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--q-bg);
            margin: 0; padding: 0;
            color: var(--q-text);
            display: flex; flex-direction: column; align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 95%; max-width: 1200px;
            background: var(--q-white);
            margin: 40px auto; padding: 40px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.08);
            border-radius: 8px;
        }

        /* HEADER */
        header { text-align: center; margin-bottom: 40px; }
        header h1 {
            color: var(--q-blue);
            font-size: 2.2rem; font-weight: 700;
            text-transform: uppercase; letter-spacing: 2px;
            margin: 0; padding-bottom: 15px; position: relative;
        }
        header h1::after {
            content: ''; display: block; width: 80px; height: 4px;
            background-color: var(--q-gold);
            margin: 15px auto 0; border-radius: 2px;
        }

        /* NAVIGARE DATE */
        .week-nav {
            display: flex; justify-content: center; gap: 15px;
            margin-bottom: 30px; flex-wrap: wrap;
        }
        .week-btn {
            background-color: var(--q-white);
            border: 1px solid var(--border);
            color: var(--q-text); padding: 14px 25px;
            font-family: 'Montserrat', sans-serif; font-weight: 600;
            font-size: 0.9rem; cursor: pointer; transition: all 0.3s ease;
            min-width: 160px; text-align: center; border-radius: 4px;
        }
        .week-btn:hover { border-color: var(--q-gold); transform: translateY(-2px); }
        .week-btn.active {
            background-color: var(--q-blue); color: var(--q-white);
            border-color: var(--q-blue); box-shadow: 0 5px 15px rgba(14, 38, 54, 0.2);
        }

        /* LIMBĂ */
        .lang-wrapper {
            display: flex; justify-content: flex-end; margin-bottom: 10px;
        }
        .lang-btn {
            background: transparent; border: 1px solid #ccc;
            padding: 6px 15px; font-size: 0.75rem; font-weight: 700;
            color: #666; cursor: pointer; border-radius: 4px;
        }
        .lang-btn:hover { border-color: var(--q-blue); color: var(--q-blue); }

        /* TABEL */
        .table-wrap {
            overflow-x: auto; border-top: 3px solid var(--q-blue);
            border-radius: 4px 4px 0 0; min-height: 300px;
        }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th {
            background-color: #F8F8F8; color: var(--q-blue);
            padding: 18px; text-transform: uppercase;
            font-size: 0.85rem; font-weight: 700;
            border: 1px solid var(--border); text-align: center;
        }
        td {
            padding: 15px; border: 1px solid var(--border);
            font-size: 0.9rem; vertical-align: middle;
            text-align: center; line-height: 1.5; color: #444;
        }
        td:first-child {
            background-color: var(--q-blue); color: var(--q-white);
            font-weight: 700; text-align: left; width: 170px;
            border-right: 1px solid #0b1f2d;
        }
        tr.row-salad td:not(:first-child) { background-color: var(--q-green); }

        /* FOOTER & ADMIN LOCK */
        footer {
            margin-top: auto; padding: 30px; text-align: center;
            font-size: 0.8rem; color: #AAA; width: 100%;
        }
        .admin-lock {
            cursor: pointer; font-size: 16px; opacity: 0.1; /* Foarte discret */
            transition: 0.3s; padding: 10px; color: #333;
        }
        .admin-lock:hover { opacity: 1; color: var(--q-blue); }

        /* ADMIN MODAL */
        .modal {
            display: none; position: fixed; z-index: 1000;
            left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(14, 38, 54, 0.95);
            backdrop-filter: blur(5px);
            overflow-y: auto;
        }
        .modal-content {
            background-color: white; margin: 5% auto; padding: 40px;
            width: 90%; max-width: 600px; border-radius: 8px; text-align: center;
            position: relative; box-shadow: 0 25px 60px rgba(0,0,0,0.5);
        }
        .close-modal {
            position: absolute; right: 20px; top: 15px;
            font-size: 30px; cursor: pointer; color: #ccc;
        }
        .close-modal:hover { color: var(--q-blue); }

        .input-group { margin-bottom: 15px; text-align: left; }
        .input-group label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.85rem; }
        .input-group input { 
            width: 100%; padding: 10px; border: 1px solid #ddd; 
            border-radius: 4px; font-family: inherit;
        }
        .btn-update {
            background-color: var(--q-blue); color: white; border: none;
            padding: 12px 20px; border-radius: 4px; font-weight: bold;
            cursor: pointer; width: 100%; margin-top: 10px;
        }
        .btn-update:hover { background-color: var(--q-gold); color: var(--q-blue); }

        .btn-download {
            background-color: #27ae60; color: white; border: none;
            padding: 15px; border-radius: 4px; font-weight: bold;
            cursor: pointer; width: 100%; margin-top: 20px; text-transform: uppercase;
            display: none; /* Ascuns inițial */
        }
        .btn-download:hover { background-color: #219150; }

        .status-log {
            margin-top: 15px; font-size: 0.8rem; color: #666; text-align: left;
            background: #f0f0f0; padding: 10px; border-radius: 4px; display: none;
        }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1>Meniul Săptămânal</h1>
        </header>

        <div class="week-nav">
            <button onclick="setWeek(0)" id="btnW0" class="week-btn active">Loading...</button>
            <button onclick="setWeek(1)" id="btnW1" class="week-btn">Loading...</button>
            <button onclick="setWeek(2)" id="btnW2" class="week-btn">Loading...</button>
            <button onclick="setWeek(3)" id="btnW3" class="week-btn">Loading...</button>
        </div>

        <div class="lang-wrapper">
            <button onclick="toggleLang()" id="btnLang" class="lang-btn">RO / EN</button>
        </div>

        <div class="table-wrap">
            <table id="menuTable">
                <thead><tr id="tableHeader"></tr></thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <footer>
        <i class="fas fa-lock admin-lock" onclick="openAdmin()" title="Admin"></i>
        <div style="margin-top:10px;">&copy; 2024 Questfield</div>
    </footer>

    <div id="adminModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeAdmin()">&times;</span>
            <h2 style="color:var(--q-blue); margin-top:0;">Actualizare Meniu</h2>
            <p style="color:#666; font-size:0.9rem; margin-bottom: 20px;">
                Lipește link-urile CSV publicate din Google Sheets pentru fiecare săptămână.
            </p>
            
            <div class="input-group">
                <label>Link CSV Săptămâna 1:</label>
                <input type="text" id="linkS1" placeholder="https://docs.google.com/.../pub?gid=...&output=csv">
            </div>
            <div class="input-group">
                <label>Link CSV Săptămâna 2:</label>
                <input type="text" id="linkS2" placeholder="https://docs.google.com/.../pub?gid=...&output=csv">
            </div>
            <div class="input-group">
                <label>Link CSV Săptămâna 3:</label>
                <input type="text" id="linkS3" placeholder="https://docs.google.com/.../pub?gid=...&output=csv">
            </div>
            <div class="input-group">
                <label>Link CSV Săptămâna 4:</label>
                <input type="text" id="linkS4" placeholder="https://docs.google.com/.../pub?gid=...&output=csv">
            </div>

            <button onclick="processUpdate()" class="btn-update">ACTUALIZEAZĂ DATELE</button>
            
            <div id="logArea" class="status-log"></div>

            <button id="downloadBtn" onclick="downloadNewIndex()" class="btn-download">
                <i class="fas fa-download"></i> Descarcă Noul Site (index.html)
            </button>
            <p id="finalMsg" style="display:none; font-size:0.8rem; margin-top:10px; color:green;">
                Acum urcă fișierul descărcat pe GitHub pentru a publica modificările!
            </p>
        </div>
    </div>

    <script>
        // =========================================================================
        // 1. DATELE (VOR FI ÎNLOCUITE AUTOMAT LA UPDATE)
        // =========================================================================
        const menuData = {
  "S1": {
    "ro": {
      "days": ["Luni", "Marți", "Miercuri", "Joi", "Vineri"],
      "rows": [
        { "type": "Felul 1", "items": ["Supă cremă de legume", "Supă de curcan", "Ciorbă de văcuță", "Supă cremă de linte", "Ciorbă țărănească"] },
        { "type": "Vegetarian", "items": ["Supă cremă de legume", "Supă de legume", "Supă cremă rădăcinoase", "Supă cremă de linte", "Ciorbă de legume"] },
        { "type": "Felul 2", "items": ["Somon la cuptor", "Friptură de curcan", "Varză călită", "Quesadilla vită", "Chicken Fingers"] },
        { "type": "Vegetarian", "items": ["Somon / Wrap", "Spanac cu ouă", "Mămăligă cu brânză", "Quesadilla veggie", "Paste Napoletana"] },
        { "type": "Salată", "items": ["Roșii și castraveți", "Grecească", "-", "Rondele legume", "Varză"] },
        { "type": "Gustare", "items": ["Mini guguluf", "Sandviș", "Chec lămâie", "Carrot Cake", "Plăcintă brânză"] }
      ]
    },
    "en": {
      "days": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"],
      "rows": [
        { "type": "Main Course", "items": ["Veg Cream Soup", "Turkey Soup", "Beef Soup", "Lentil Soup", "Rustic Chicken"] },
        { "type": "Vegetarian", "items": ["Veg Cream Soup", "Veg Soup", "Root Soup", "Lentil Soup", "Rustic Veg"] },
        { "type": "Second Course", "items": ["Baked Salmon", "Roasted Turkey", "Cabbage & Polenta", "Beef Quesadilla", "Chicken Fingers"] },
        { "type": "Vegetarian", "items": ["Salmon / Wrap", "Spinach & Eggs", "Polenta & Cheese", "Veggie Quesadilla", "Pasta"] },
        { "type": "Salad", "items": ["Tomato Salad", "Greek Salad", "-", "Veggie Slices", "Cabbage"] },
        { "type": "Snack", "items": ["Bundt Cake", "Sandwich", "Lemon Cake", "Carrot Cake", "Cheese Pie"] }
      ]
    }
  },
  "S2": { "ro": { "days": ["Luni", "Marți", "Miercuri", "Joi", "Vineri"], "rows": [ { "type": "Felul 1", "items": ["Supă rădăcinoase", "Supă pui", "Borș curcan", "Supă morcovi", "Ciorbă perișoare"] }, { "type": "Vegetarian", "items": ["Supă rădăcinoase", "Supă legume", "Borș legume", "Supă morcovi", "Ciorbă legume"] }, { "type": "Felul 2", "items": ["Curcan sos alb", "Aripioare pui", "Ardei umpluți", "Pulpe pui", "Penne 4 brânzeturi"] }, { "type": "Vegetarian", "items": ["Halloumi", "Cașcaval pane", "Ardei umpluți", "Tocăniță legume", "Penne 4 brânzeturi"] }, { "type": "Salată", "items": ["Mix salată", "Varză", "Legume", "Sfeclă", "Broccoli"] }, { "type": "Gustare", "items": ["Sandviș", "Ștrudel", "Prăjitură", "Chec", "Lipie humus"] } ] }, "en": { "days": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"], "rows": [ { "type": "Main Course", "items": ["Root Soup", "Chicken Soup", "Turkey Borsch", "Carrot Soup", "Meatball Soup"] }, { "type": "Vegetarian", "items": ["Root Soup", "Veg Soup", "Veg Borsch", "Carrot Soup", "Veg Soup"] }, { "type": "Second Course", "items": ["Turkey White Sauce", "Chicken Wings", "Stuffed Peppers", "Chicken Legs", "4-Cheese Penne"] }, { "type": "Vegetarian", "items": ["Halloumi", "Fried Cheese", "Stuffed Peppers", "Veg Stew", "4-Cheese Penne"] }, { "type": "Salad", "items": ["Mix Salad", "Coleslaw", "Veggies", "Beetroot", "Broccoli"] }, { "type": "Snack", "items": ["Sandwich", "Strudel", "Cake", "Cake", "Hummus"] } ] } },
  "S3": { "ro": { "days": ["Luni", "Marți", "Miercuri", "Joi", "Vineri"], "rows": [ { "type": "Felul 1", "items": ["Supă roșii", "Supă găluște", "Supă morcovi", "Ciorbă curcan", "Ciorbă pui"] }, { "type": "Vegetarian", "items": ["Supă roșii", "Supă legume", "Supă morcovi", "Borș legume", "Supă legume"] }, { "type": "Felul 2", "items": ["Specialitate grecească", "Pui parmezan", "Vită înăbușită", "Mazăre/Curcan", "Pui crispy"] }, { "type": "Vegetarian", "items": ["Specialitate veg", "Couscous", "Gratin broccoli", "Mazăre", "Cașcaval cuptor"] }, { "type": "Salată", "items": ["Mix salată", "Grecească", "Varză", "Sfeclă", "Verde"] }, { "type": "Gustare", "items": ["Guguluf", "Plăcintă", "Mascarpone", "Carrot cake", "Iaurt"] } ] }, "en": { "days": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"], "rows": [ { "type": "Main Course", "items": ["Tomato Soup", "Dumpling Soup", "Carrot Soup", "Turkey Soup", "Greek Chicken"] }, { "type": "Vegetarian", "items": ["Tomato Soup", "Veg Soup", "Carrot Soup", "Veg Borsch", "Veg Soup"] }, { "type": "Second Course", "items": ["Greek Special", "Parmesan Chicken", "Braised Beef", "Peas/Turkey", "Crispy Chicken"] }, { "type": "Vegetarian", "items": ["Greek Special Veg", "Couscous", "Broccoli Gratin", "Peas", "Baked Cheese"] }, { "type": "Salad", "items": ["Mix Salad", "Greek Salad", "Coleslaw", "Beetroot", "Green Salad"] }, { "type": "Snack", "items": ["Bundt", "Pie", "Cake", "Carrot Cake", "Yogurt"] } ] } },
  "S4": { "ro": { "days": ["Luni", "Marți", "Miercuri", "Joi", "Vineri"], "rows": [ { "type": "Felul 1", "items": ["Supă rădăcinoase", "Supă alfabet", "Borș țărănesc", "Supă vită", "Ciorbă perișoare"] }, { "type": "Vegetarian", "items": ["Supă rădăcinoase", "Ciorbă oltenească", "Borș țărănesc", "Ciorbă legume", "Supă linte"] }, { "type": "Felul 2", "items": ["Biban", "Pui mediteranean", "Ostropel curcan", "Specialitate italiană", "Cașcaval pane"] }, { "type": "Vegetarian", "items": ["Biban / Paste", "Halloumi", "Tocăniță năut", "Specialitate italiană", "Cașcaval pane"] }, { "type": "Salată", "items": ["Verde", "-", "Varză", "Mix legume", "Crudități"] }, { "type": "Gustare", "items": ["Focaccia", "Banana Bread", "Clătite", "Orez lapte", "Prăjitură"] } ] }, "en": { "days": ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday"], "rows": [ { "type": "Main Course", "items": ["Root Soup", "Chicken Alphabet", "Rustic Borsch", "Beef Soup", "Meatball Soup"] }, { "type": "Vegetarian", "items": ["Root Soup", "Oltenian Soup", "Rustic Borsch", "Veg Soup", "Lentil Soup"] }, { "type": "Second Course", "items": ["Seabass", "Mediterranean Chicken", "Turkey Stew", "Italian Special", "Breaded Cheese"] }, { "type": "Vegetarian", "items": ["Seabass/Pasta", "Grilled Halloumi", "Chickpea Stew", "Italian Special", "Breaded Cheese"] }, { "type": "Salad", "items": ["Green Salad", "-", "Cabbage", "Veg Mix", "Raw Salad"] }, { "type": "Snack", "items": ["Focaccia", "Banana Bread", "Pancakes", "Rice Pudding", "Cake"] } ] } }
};

        // =========================================================================
        // 2. LOGICA APLICAȚIEI
        // =========================================================================
        let currentLang = 'ro';
        let activeIdx = 0; 
        let tempNewData = JSON.parse(JSON.stringify(menuData)); // Clonă pentru update

        // --- CALENDAR & BUTOANE ---
        function getMonday(d) {
            d = new Date(d);
            var day = d.getDay(), diff = d.getDate() - day + (day == 0 ? -6 : 1);
            return new Date(d.setDate(diff));
        }
        function formatDate(d) {
            let dd = d.getDate().toString().padStart(2,'0');
            let mm = (d.getMonth()+1).toString().padStart(2,'0');
            return `${dd}.${mm}`;
        }
        function updateButtons() {
            let today = new Date();
            let start = getMonday(today);
            for(let i=0; i<4; i++) {
                let s = new Date(start); s.setDate(start.getDate() + i*7);
                let e = new Date(s); e.setDate(s.getDate() + 4);
                let btn = document.getElementById(`btnW${i}`);
                if(btn) btn.textContent = `${formatDate(s)} - ${formatDate(e)}`;
            }
        }

        // --- RENDER MENU ---
        function renderMenu(sourceData = menuData) {
            let key = `S${activeIdx+1}`;
            let data = sourceData[key] ? sourceData[key][currentLang] : null;
            let thead = document.getElementById('tableHeader');
            let tbody = document.getElementById('tableBody');

            if(!data) {
                tbody.innerHTML = `<tr><td colspan="6" style="padding:20px;text-align:center">Lipsă date pentru ${key}.</td></tr>`;
                return;
            }

            thead.innerHTML = `<th>${currentLang==='ro'?'Categorie':'Course'}</th>`;
            data.days.forEach(d => {
                let th = document.createElement('th'); th.textContent = d; thead.appendChild(th);
            });

            tbody.innerHTML = '';
            data.rows.forEach(r => {
                let tr = document.createElement('tr');
                if(r.type.toLowerCase().includes('salat') || r.type.toLowerCase().includes('salad')) tr.classList.add('row-salad');
                
                let td = document.createElement('td'); td.innerHTML = r.type; tr.appendChild(td);
                r.items.forEach(it => {
                    let cell = document.createElement('td'); cell.textContent = it || '-'; tr.appendChild(cell);
                });
                tbody.appendChild(tr);
            });

            document.querySelectorAll('.week-btn').forEach((b,i) => {
                if(i===activeIdx) b.classList.add('active'); else b.classList.remove('active');
            });
        }

        function setWeek(i) { activeIdx = i; renderMenu(); }
        function toggleLang() {
            currentLang = currentLang==='ro'?'en':'ro';
            document.getElementById('btnLang').textContent = currentLang==='ro'?'RO / EN':'EN / RO';
            renderMenu();
        }

        // --- ADMIN PANEL & UPDATE LOGIC ---
        function openAdmin() {
            let p = prompt("Parola Administrator:");
            if(p === "questfield") {
                document.getElementById('adminModal').style.display = 'block';
            } else if(p) alert("Parolă greșită");
        }
        function closeAdmin() {
            document.getElementById('adminModal').style.display = 'none';
        }

        // Funcția magică de Update
        function processUpdate() {
            let links = [
                document.getElementById('linkS1').value.trim(),
                document.getElementById('linkS2').value.trim(),
                document.getElementById('linkS3').value.trim(),
                document.getElementById('linkS4').value.trim()
            ];

            let logArea = document.getElementById('logArea');
            logArea.style.display = 'block';
            logArea.innerHTML = 'Începem descărcarea datelor...<br>';

            let promises = [];
            
            links.forEach((url, index) => {
                if(url) {
                    // Adăugăm timestamp pentru a evita cache-ul Google
                    let cacheBusterUrl = url + "&t=" + new Date().getTime();
                    
                    promises.push(new Promise(resolve => {
                        Papa.parse(cacheBusterUrl, {
                            download: true,
                            complete: function(results) {
                                let parsed = parseData(results.data);
                                if(parsed) {
                                    tempNewData[`S${index+1}`] = parsed;
                                    logArea.innerHTML += `<span style="color:green">✔ Saptamana ${index+1} actualizată!</span><br>`;
                                } else {
                                    logArea.innerHTML += `<span style="color:red">✘ Eroare structură S${index+1}</span><br>`;
                                }
                                resolve();
                            },
                            error: function() {
                                logArea.innerHTML += `<span style="color:red">✘ Eroare rețea S${index+1}</span><br>`;
                                resolve();
                            }
                        });
                    }));
                }
            });

            Promise.all(promises).then(() => {
                logArea.innerHTML += '<br><b>Proces finalizat!</b>';
                document.getElementById('downloadBtn').style.display = 'inline-block';
                document.getElementById('finalMsg').style.display = 'block';
                // Facem update vizual imediat ca preview
                menuData = JSON.parse(JSON.stringify(tempNewData));
                renderMenu();
            });
        }

        function parseData(rows) {
            let roIdx = -1, enIdx = -1;
            for(let i=0; i<rows.length; i++) {
                let str = JSON.stringify(rows[i]).toLowerCase();
                if(str.includes("luni")) roIdx = i;
                if(str.includes("monday")) enIdx = i;
            }
            if(roIdx === -1 || enIdx === -1) return null;
            return { ro: extract(rows, roIdx), en: extract(rows, enIdx) };
        }

        function extract(rows, start) {
            let header = rows[start];
            let days = header.slice(1, 6).filter(d => d); // Presupunem zilele pe col 1-5
            
            // Fallback dacă CSV-ul e decalat
            let startCol = 1;
            if(days.length < 5) {
               // Căutăm unde începe Luni
               for(let k=0; k<header.length; k++) {
                   if(header[k] && (header[k].toLowerCase().includes('luni') || header[k].toLowerCase().includes('monday'))) {
                       startCol = k;
                       break;
                   }
               }
               days = header.slice(startCol, startCol+5);
            }

            let dataRows = [];
            let i = start + 1;
            while(i < rows.length && dataRows.length < 6) {
                let r = rows[i];
                let catIdx = startCol > 0 ? startCol - 1 : 0;
                if(r && r[catIdx]) {
                    dataRows.push({ type: r[catIdx], items: r.slice(startCol, startCol+5) });
                }
                i++;
            }
            return { days: days, rows: dataRows };
        }

        // GENERARE FIȘIER NOU (SELF-REPLICATION)
        function downloadNewIndex() {
            let htmlContent = document.documentElement.outerHTML;
            // Înlocuim variabila menuData veche cu cea nouă
            let jsonString = `const menuData = ${JSON.stringify(tempNewData, null, 2)};`;
            let newHtml = htmlContent.replace(/const menuData\s*=\s*\{[\s\S]*?\};/, jsonString);

            let blob = new Blob([newHtml], {type: "text/html"});
            let link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = "index.html";
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // INIT
        window.onload = function() {
            updateButtons();
            renderMenu();
        };
    </script>
</body>
</html>
